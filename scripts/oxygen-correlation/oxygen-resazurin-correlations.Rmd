---
title: Oxygen rate extraction 
author: "AS Huffmyer"
date: '2025'
output:
  github_document: null
  md_document: default
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 6
    toc_float: true
editor_options: 
  chunk_output_type: console
---

This script conducts correlations between respiration and resazurin rates.      

# Set up 

Set up workspace, set options, and load required packages.    
```{r}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(emmeans)
library(ggplot2)
```

# Read in files 

Read in oxygen files 
```{r}
resp<-read_csv(file="output/oxygen-correlation/extracted_oxygen_rates.csv")%>%select(!c("plate", "well", "length.mm"))

resazurin<-read_csv(file="output/oxygen-correlation/resazurin_oyster_metrics.csv")

df<-left_join(resp, resazurin)%>%rename(resazurin_slope=slope, resazurin_total=value)

head(df)
```

Check for outliers 
```{r}
hist(df$resazurin_slope)
hist(df$R.umol.mm.min)
```

Change respiration to inverse so that a higher value means higher metabolic rate. 
```{r}
df$R.umol.mm.min<-df$R.umol.mm.min*-1
```

Remove respiration values that are close to 0 and upper outliers.  

```{r}
hist(df$R.umol.mm.min)

df<-df%>%
  filter(R.umol.mm.min>0.0001)%>%
  filter(R.umol.mm.min<0.0007)

hist(df$R.umol.mm.min)
```

Transform variables. 

```{r}
df$resazurin_slope_t<-log(1+df$resazurin_slope)

hist(df$resazurin_slope_t)

df$R.umol.mm.min_t<-sqrt(df$R.umol.mm.min)

hist(df$R.umol.mm.min_t)
```

Remove outliers in resazurin data. 

```{r}
#df<-df%>%
  #filter(resazurin_slope_t<0.5)

#hist(df$resazurin_slope_t)
```

# Plot correlation 

```{r}
plot1<-df%>%
  
  ggplot(aes(x=R.umol.mm.min_t, y=resazurin_slope_t))+
  geom_point(color="darkgray")+
  geom_smooth(method="lm", color="black")+
  theme_classic(); plot1
```

We expect a positive correlation because I am showing the reciprocal of the respiration values (higher slope = more oxygen produced). 
Conduct correlation test. 

```{r}
cor.test(df$R.umol.mm.min, df$resazurin_slope)
```


